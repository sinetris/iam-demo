---
# To generate reference values, run:
#   helm show values prometheus-community/kube-prometheus-stack
nameOverride: grafana-stack
namespaceOverride: observability

commonLabels:
  app.kubernetes.io/component: observability
  app.kubernetes.io/part-of: grafana-stack

alertmanager:
  enabled: true
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: iam-demo-certs-issuer
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    labels:
      app.kubernetes.io/name: alertmanager
    hosts:
    - alertmanager.iam-demo.test
    paths:
    - /
    pathType: Prefix
    tls:
    - secretName: iam-demo-alertmanager-tls
      hosts:
      - alertmanager.iam-demo.test

grafana:
  enabled: true
  adminPassword: iam-demo-operator
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: iam-demo-certs-issuer
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    labels:
      app.kubernetes.io/name: grafana
    hosts:
    - grafana.iam-demo.test
    paths:
    - /
    pathType: Prefix
    tls:
    - secretName: iam-demo-grafana-tls
      hosts:
      - grafana.iam-demo.test

prometheus:
  enabled: true
  ingress:
    enabled: true
    ingressClassName: traefik
    annotations:
      cert-manager.io/cluster-issuer: iam-demo-certs-issuer
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
    labels:
      app.kubernetes.io/name: prometheus
    hosts:
    - prometheus.iam-demo.test
    paths:
    - /
    pathType: Prefix
    tls:
    - secretName: iam-demo-prometheus-tls
      hosts:
      - prometheus.iam-demo.test
  monitor:
    relabelings:
      - action: replace
        replacement: loki
        targetLabel: cluster

cleanPrometheusOperatorObjectNames: true

kubelet:
  serviceMonitor:
    cAdvisorRelabelings:
      - action: replace
        replacement: loki
        targetLabel: cluster
      - targetLabel: metrics_path
        sourceLabels:
          - "__metrics_path__"
      - targetLabel: "instance"
        sourceLabels:
          - "node"

defaultRules:
  additionalRuleLabels:
    cluster: loki

"kube-state-metrics":
  prometheus:
    monitor:
      relabelings:
        - action: replace
          replacement: loki
          targetLabel: cluster
        - targetLabel: "instance"
          sourceLabels:
            - "__meta_kubernetes_pod_node_name"

"prometheus-node-exporter":
  prometheus:
    monitor:
      relabelings:
        - action: replace
          replacement: loki
          targetLabel: cluster
        - targetLabel: "instance"
          sourceLabels:
            - "__meta_kubernetes_pod_node_name"

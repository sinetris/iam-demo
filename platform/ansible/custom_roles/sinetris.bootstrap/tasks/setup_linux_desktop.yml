---
- name: Ensures ~/.mozilla/certificates exists
  ansible.builtin.file:
    path: /home/{{ desktop_user }}/.mozilla/certificates
    state: directory
    owner: "{{ desktop_user }}"
    group: "{{ desktop_user }}"
    mode: "u=rwx,g=rx,o=rx"
- name: Create CA certs hard links for Firefox
  ansible.builtin.file:
    src: "{{ system_ca_root_path }}/{{ item }}"
    dest: '/home/{{ desktop_user }}/.mozilla/certificates/{{ item }}'
    owner: "{{ desktop_user }}"
    group: "{{ desktop_user }}"
    state: hard
  loop:
      - "{{ project_name }}-root-ca.crt"
      - "{{ project_name }}-intermediate-ca.crt"
- name: Ensures /etc/firefox/policies exists
  ansible.builtin.file:
    path: /etc/firefox/policies
    state: directory
    mode: "u=rwx,g=rwx,o=rx"
- name: Install certificates into the Firefox certificate store.
  ansible.builtin.template:
    src: firefox-policies.json.j2
    dest: "/etc/firefox/policies/policies.json"
    mode: u=rw,g=r,o=r
  vars:
    custom_ca_paths:
      - "{{ project_name }}-root-ca.crt"
      - "{{ project_name }}-intermediate-ca.crt"
